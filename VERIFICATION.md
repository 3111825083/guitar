# ✅ 部署验证清单

在部署完成后，按照此清单验证应用是否正常工作。

## 🔍 前置检查

- [ ] Node.js 版本 >= 18
- [ ] npm 已安装
- [ ] 项目文件完整
- [ ] 依赖已安装：`npm install`

## 🚀 本地启动验证

```bash
npm start
```

- [ ] 服务器成功启动（显示"✅ 吉他谱服务器启动"）
- [ ] 监听端口 3000
- [ ] 无错误日志

## 🌐 前端功能验证

打开 http://localhost:3000

### 首页
- [ ] 页面正常加载
- [ ] 显示吉他谱列表（4张卡片）
- [ ] 搜索框可用
- [ ] 我的收藏按钮可用
- [ ] 收藏功能正常（点击星形）

### 谱子详情页
打开任意谱子（例：点击"成都"）

- [ ] 页面正常加载
- [ ] 显示谱子信息（歌手、类型、浏览、下载）
- [ ] 显示谱子图片
- [ ] "全屏查看"按钮可用
- [ ] "自动滚动"按钮可用
- [ ] "下载谱子"按钮可用
- [ ] "打印谱子"按钮可用

### 全屏模式
点击"全屏查看"按钮

- [ ] 全屏容器显示
- [ ] 谱子图片正确展示
- [ ] 关闭按钮（X）可用
- [ ] "自动滚动"按钮显示
- [ ] "录制时间戳"按钮显示（蓝色十字）
- [ ] "设置"按钮显示
- [ ] 按 ESC 能退出全屏

### 自动滚动功能
- [ ] 点击"自动滚动"开始播放
- [ ] 图标变为暂停符号
- [ ] 页面自动向下滚动
- [ ] 再次点击暂停
- [ ] 模式切换后继续播放
- [ ] 调整速度后有效

## 🎯 时间戳录制功能

1. 全屏模式下，点击"录制时间戳"（蓝色按钮）

- [ ] 进入录制模式（按钮变蓝）
- [ ] 光标变为十字准星（✕）
- [ ] 显示"已记录 0 个时间戳"

2. 点击谱子图片上的位置

- [ ] 弹出输入框
- [ ] 显示点击的像素位置
- [ ] 可以输入时间戳

3. 输入时间戳（例如：0）

- [ ] 记录成功
- [ ] "已记录"计数增加（显示"已记录 1 个时间戳"）

4. 重复操作录制多个时间戳

- [ ] 可以记录 3-5 个不同的时间戳
- [ ] 计数继续增加

5. 再次点击"录制时间戳"退出

- [ ] 弹出确认对话框
- [ ] 显示所有已记录的时间戳
- [ ] 询问是否保存

6. 点击"确定"保存

- [ ] 显示"时间戳已成功保存!"
- [ ] 配置被保存到后端

## 🔗 API 验证

### 1. 健康检查
```bash
curl http://localhost:3000/api/health
```

- [ ] 返回 200 状态码
- [ ] 响应包含 `status: "ok"`
- [ ] 包含 `timestamp`

### 2. 获取所有配置
```bash
curl http://localhost:3000/api/tabs
```

- [ ] 返回 200 状态码
- [ ] 返回包含 4 个谱子的对象
- [ ] 每个谱子包含必要字段

### 3. 获取单个谱子
```bash
curl http://localhost:3000/api/tabs/成都
```

- [ ] 返回 200 状态码
- [ ] 返回"成都"的配置对象
- [ ] 包含 `scroll` 数组字段

### 4. 保存配置
```bash
curl -X POST http://localhost:3000/api/save-config \
  -H "Content-Type: application/json" \
  -d '{
    "tabKey": "成都",
    "scroll": [
      {"time": 0, "position": 0},
      {"time": 5, "position": 400}
    ]
  }'
```

- [ ] 返回 200 状态码
- [ ] 返回 `message: "配置已保存"`
- [ ] `tabs-config.json` 已更新
- [ ] `tabs-config-backup.json` 已创建

## 📱 响应式设计验证

打开浏览器开发工具（F12）

### 桌面版本（> 1024px）
- [ ] 4 列网格布局
- [ ] 完整菜单显示

### 平板版本（768px - 1024px）
- [ ] 2-3 列网格布局
- [ ] 菜单部分隐藏

### 手机版本（< 768px）
- [ ] 1 列布局
- [ ] 菜单完全隐藏或折叠

## 🐛 错误处理验证

### 访问不存在的谱子
```bash
curl http://localhost:3000/api/tabs/不存在的谱子
```
- [ ] 返回 404 错误
- [ ] 包含清晰的错误信息

### 无效的请求
```bash
curl -X POST http://localhost:3000/api/save-config \
  -H "Content-Type: application/json" \
  -d '{"invalid": "data"}'
```
- [ ] 返回 400 错误
- [ ] 包含参数验证错误信息

## 💾 数据持久化验证

1. 打开浏览器开发工具（F12）→ Application → Local Storage
   - [ ] 见到 `collectedTabs` 记录

2. 收藏一个谱子
   - [ ] 刷新页面后收藏仍然存在
   - [ ] Local Storage 中数据已更新

3. 关闭并重新打开浏览器
   - [ ] 收藏仍然保持

## 📊 性能验证

打开浏览器开发工具（F12）→ Performance

- [ ] 首页加载时间 < 2s
- [ ] 谱子详情页加载时间 < 3s
- [ ] 自动滚动帧率稳定在 60 FPS
- [ ] 内存占用稳定（无持续增长）

## 🌍 CORS 验证

从不同源测试 API 调用

```javascript
// 在浏览器控制台运行
fetch('http://localhost:3000/api/tabs')
  .then(r => r.json())
  .then(d => console.log(d))
```

- [ ] 请求成功，无 CORS 错误
- [ ] 返回正确数据

## 📝 日志验证

查看应用日志

```bash
pm2 logs guitar  # 如果使用 PM2
# 或查看 server.log 文件
```

- [ ] 无错误信息
- [ ] 无警告（除了忽略的一些 deprecation 警告）
- [ ] API 请求被正确记录

## 🚀 部署验证（云平台）

### Railway / Vercel 部署后

- [ ] 访问部署 URL，首页加载正常
- [ ] 所有功能正常工作
- [ ] API 调用成功
- [ ] 自动滚动功能完整
- [ ] 时间戳录制功能完整
- [ ] 配置保存成功

### 自建 VPS 部署后

- [ ] SSH 登录成功
- [ ] 应用通过 PM2 运行
- [ ] 日志输出正常
- [ ] Nginx 反向代理工作
- [ ] HTTPS 证书有效
- [ ] 公网 IP/域名可访问

## 🎉 最终检查

- [ ] 所有功能都已测试
- [ ] 没有控制台错误
- [ ] 所有测试都通过
- [ ] 文档已更新
- [ ] 代码已提交

---

## 📞 常见问题

**Q: 某个测试失败了怎么办？**
A: 查看浏览器控制台和服务器日志，根据错误信息排查。

**Q: API 返回 CORS 错误？**
A: 检查 `.env` 文件中的 `CORS_ORIGIN` 配置。

**Q: 时间戳保存失败？**
A: 确保 `tabs-config.json` 文件有写入权限。

---

✅ **验证完成！应用已准备好生产环境部署！**
